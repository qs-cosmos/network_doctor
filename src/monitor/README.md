# Monitor

## 版本支持

当前版本: version-0.0.1-test

支持平台: Linux 4.15.0-47-generic - Ubuntu 18.04

支持协议: IPv4 ICMP TCP UDP DNS

## 设计目标

Monitor 部署在用户主机, 以获取用户使用网络时产生的实时数据, 是Woodpecker基于用户
视角分析网络通信状况的基础。其主要工作包括获取主机网卡的基本信息, 对进出主机的网
络流量进行初步的统计以及获取主机各进程的系统资源使用率。

## 基本思想

### 基本概念

+ 使用 **MAC地址**(Media Access Control Address) 唯一标识一张网卡
    - 一台主机可能同时包含多张网卡

+ 使用 **IP地址** 唯一标识一个服务网络
    - Woodpecker 关注的是用户主机访问 **IP地址** 标识的服务的通信时延
    - **IP地址** 可能是一个负载均衡** VIP**, 负载均衡调度过程对于用户主机来说是一个"黑盒"

+ 四元组 **[MAC, sport, IP, dport]** 唯一标识一个网络请求
    - sport => 源端口, dport => 目的端口, IP => 服务网络

+ 三元组 **[主机IP/子网掩码, 默认网关, 出口IP]** 唯一标识一个用户网络
    - **主机IP/子网掩码** => 子网地址
    - 访问不同的服务网络时, **出口IP** 可能不同 => 一张网卡可能同时归属于多个用户网络

+ 四元组 **[主机IP/子网掩码, 默认网关, 出口IP, 服务IP]** 唯一标识一组用户网络与服务网络通信集合

### 数据采集

+ 底层数据 => 抽象数据 => 评估指标

## 数据采集

根据 Monitor 设计目标, 明确待采集的数据类型, 并制定数据采集模式以及存储方案。

### 数据类型

#### 基本信息

**NIC (Network Interface Controller)**
+ 设备名
+ MAC 地址
+ IPv4/子网掩码/默认网关

#### 时序数据

**网络通信**
+ TCP
    - 报文解析 (`libpcap[抓包] netinet[报文解构]`)
    - 主机套接字 (`[netlink => NETLINK_INET_DIAG] [ss -i -p -n -m -t `)
