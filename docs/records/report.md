# 一个基础网络检测工具的设计与实现


## 一、选题背景和意义

+ 计算机网络的重要性?
    自冯·诺伊曼体系结构提出以来, 计算机科学技术得到了长足发展, 操作系统技术、数据库技术和计算机网络技术则是现今计算机科学领域中最重要的三块"基石"。其中, 计算机网络技术利用通信设备和信道将地理位置不同的、功能独立的多个计算机系统连接起来, 并在网络操作系统、网络管理软件和网络通信协议的管理和协调下, 实现了网络中快速地信息传递和资源共享, 极大地促进了信息时代的到来。如今, 计算机网络已经普及到人们日常生活的方方面面, 与电力、电话一样, 成为维系现代社会正常运作的重要纽带之一, 保证网络持续、高效和安全地运行变得至关重要。

+ 网络检测的意义?
    网络故障诊断是网络管理的核心部分。由于通信协议、硬件、软件以及物理环境(如温度、湿度)等多种因素的影响下, 网络系统可能会在许多不可预测的时刻发生故障。早期的故障诊断主要由专业技术人员人工进行 —— 首先, 技术人员对系统进行不间断的观察, 来获取各种网络资源和网络节点的状态信息; 然后, 对获取的信息进行筛选过滤; 最后, 结合过往的经验和直觉得出故障诊断结果。人工诊断的方式往往代价高昂且诊断效率低下。随着网络规模的扩大, 网络逐步向异构性、动态性和智能化的方向发展,这些变化对网络故障诊断提出了越来越高的要求, 这种方式已经很难满足高强度、快节奏的现代信息社会的需求。因此迫切需要一个可以在网络出现故障时指导管理人员以最小代价、最快速度定位故障、排除故障的智能辅助决策系统, 并且该系统可以通过知识的积累, 不断提高系统的故障诊断能力, 降低对网络管理人员的要求。通过提高网络故障诊断能力, 实现快速准确的故障诊断, 对提高网络系统的鲁棒性和系统服务的可用性至关重要, 对减少网络故障的修复时间和降低网络的维护成本也具有重要意义。

+ 网络检测的发展?
    实现网络快速故障诊断的主要障碍之一就是复杂网络故障诊断中广泛存在的不确定性问题。要使智能故障诊断技术走向工程实际, 首先必须解决不确定性问题的求解。目前, 国内外学者对故障诊断技术, 进行了深入的研究, 提出了很多行之有效的理论和方法。从方法上看一般采用序贯搜索技术, 就优化准则来说主要有基于信息量、基于风险、基于时间开销、基于费用开销等准则, 就推理模型来说主要有故障树、决策树、马尔柯夫可靠性模型、信息模型、故障传播有向图模型、Petri网、概率论因果网络、节约覆盖集等。所涉及的理论主要包括概率理论、模糊理论、信息理论、图论、多目标优化决策理论、序贯决策论。所有方法都遵守"最小代价"原则, 具体目标一致, 即期望的故障发现率和定位率最高, 所有诊断时间最短, 搜索成本最低。

+ 本课题的目标?
    在企业实践中发现: 用户通过网络访问某共享资源出现问题时, 往往会首先将问题归结于网络问题。而如何在最短的时间内, 明确问题是网络问题、诊断问题原因以及提出解决或缓解问题的方案, 常常使网络管理员焦头烂额。本课题将致力于开发一个在问题发生时可以指导管理人员以最小代价、最快速度明确问题、定位原因和解决问题的网络检测工具。


## 二、课题关键问题及难点

根据在企业实践的经验, 构建完善的网络检测工具主要存在三个方面的难点:

1. 信息获取
    在网络问题检测过程中, 信息获取是一个重要环节。网络系统一般由很多不同的组件构成, 如主机、路由器、交换机等, 组成结构错综复杂, 不同组件之间相互关联耦合, 存在大量的不确定因素, 包括通信协议、硬件、软件和物理环境等。因此, 对网络系统进行观测往往能够获取大量的信息, 但是其中不乏冗余、无效的数据需要过滤。同时, 对于不同的硬件和操作系统, 获取网络数据的接口支持可能是各异的, 如何实现跨平台、多源的信息获取也将是一个巨大的挑战。综上所述, 受到各种因素的限制, 能获得的有效观测数据是有限的, 而且往往可能是不完整的、不精确的。

2. 信息处理
    简单地说, 诊断就是由问题现象获得最终问题原因的推理过程, 问题现象和问题原因之间往往具有一定的因果关联关系。然而, 对于复杂网络而言, 这种因果关联关系并不一定是确定的映射关系, 而往往由于诊断对象的复杂性、测试手段的局限性、知识表达的不精确, 使得问题现象和问题原因之间的映射表现为随机性和不确定性。同时, 信息获取也存在诸多的限制, 因此, 如何在不充分、不完整、不确定的信息条件下完成决策模型的推理是信息处理面临的关键问题。

3. 仿真网络
    本课题构思来源于实践中, 但是由于时效性的要求, 在问题发生时, 往往首先专注于探索问题的解决或缓解方案, 对"现场事件"数据未曾进行系统地记录和存储。因此, 在构建网络检测工具的网络诊断模块时, 缺乏大量的先验数据来构建和训练用于处理数据的数学模型。同时, 网络检测工具开发完成后, 必须测试和验证工具的有效性和准确性, 避免对正常的网络环境产生意料之外的影响。因此, 必须构建一个仿真的网络环境, 通过注入各种故障来获取先验数据, 并作为测试环境对网络检测工具进行验证。


## 三、文献综述

计算机网络检测技术综述

+ 网络检测技术的目标
   随着网络规模的扩大, 网络逐步向异构性、动态性和智能化的方向发展, 国内外学者对网络检测技术也进行了很多深入的研究化。根据各种研究基于的网络场景, 待检测的网络对象可以归纳为规模依次增大的家庭网络、企业网络和数据中心网络, 保持各个网络实时畅通是提高用户体验的重要前提。正常情况下, 提供给用户的网络应用和服务运行良好, 但有时会出现一些异常行为, 通常表现为用户访问延迟增加、访问无应答等现象。这些异常行为往往是底层网络中通信出现瓶颈的表现, 但是也无法排除应用程序本身漏洞、系统资源不足等其他问题的可能性。网络检测的目标就是发现这些异常行为, 并区分和定位产生它们的根本原因。基于计算机系统的性能指标以及资源的利用率, 对异常行为进行图表化, 根据离散点或连续点的图像特征划分了Point, Collective, Contextual 和 Pattern 四种异常类型。还描述了限制系统性能的资源或应用, 并将之称为瓶颈, 包括资源饱和瓶颈以及资源争用瓶颈。造成这些异常和瓶颈的原因分为以下几类:
    1) 应用错误 —— 例如对配置文件进行错误的更改, 软件更新或代码存在错误等应用层的问题, 可能会触发意料之外的资源瓶颈事故。
    2) 工作负载 —— 指应用由于突发原因在某一时刻显著偏离平均或预期的工作负载强度, 可能会导致网络流量的拥塞控制出错, 以及线程资源的过量分配等问题。
    3) 平台架构 —— 指短时间内在底层系统架构或操作系统发生的瞬态事件。例如, 存储器硬件错误, JVM"垃圾回收"引发资源瓶颈等。
    4) 系统错误 —— 一般可归因于系统软件错误, 操作员错误, 硬件故障, 环境问题和安全违规。这类故障可能是间歇性的, 突发的或永久的, 并可能会严重影响应用性能。
    网络检测技术中包含两个关键内容, 分别是数据采集和数据分析。数据采集的数量和质量往往会直接影响到数据分析的有效性和准确性。
+ 网络检测技术的关键 —— 数据采集
    数据采集是指对系统进行系统性、规律性地监控和采样, 从而获得一组时间序列上与系统相关的性能指标值。性能指标是系统的或者某个能够表示系统状态的组件的一个属性, 往往可以用一组与系统密切相关的性能指标值向量来描绘系统特定时刻发生的一个问题。基于数据的粒度大小, 将大多数研究中采集的数据分为两个层次: 应用性能指标和系统底层性能指标。应用程序性能指标是用来描述当前应用程序或进程的运行状态, 例如, 响应时间, 吞吐量; 系统底层性能指标是指表示当前底层硬件或操作系统状态的属性值, 例如, CPU使用率, IO等待时间等。数据采集通过使用操作系统内核内建性能计数器或安装自动化第三方客户端工具, 收集应用程序和操作系统的性能数据。采集方式也分主动和被动。主动是指主动向网络中注入测试流量, 直接测量需要的性能指标, 而无需等待特定事件发生。这种方式需要最小化注入流量对正常网络通信的影响, 其影响程度往往取决于流量注入的大小和频率。另外测试流量需要尽可能类似于实际流量, 否则, 采集到的性能数据可能与网络实际运行状态不完全匹配。被动则是依赖网络设备(例如, 路由器和交换机)或终端主机观测实际的系统状态或网络行为, 可能需要等待很长时间才能观测到特定的事件数据。鉴于主动和被动的特性, 一般同时使用主动和被动的方式采集数据。在实际网络中, 很多性能指标的可观测性很大程度上取决于基础网络结构的组成和应用服务提供商的服务配置。例如, 在数据中心网络中可以直接观测网络底层基础设施甚至应用服务源代码, 而在云环境中, 应用服务对于云提供商是一个"黑盒子", 应用服务提供商则缺少虚拟机之外的全局网络架构视图。

    Profiling 不仅仅记录系统状态, 还研究资源消耗和依赖关系, 以便评估系统的整体性能。它还设涉及建立可用于描述系统动态和预测性能的分析模型。Tracing通过源码工具来跟踪细粒度网络或代码级事件和错误行为。
    监控获取的数据不仅取决于度量空间, 还取决于我们收集它们的速率。较短的采样间隔比较长采样间隔提供更精细的分辨率, 即使经过额外的计算和存储开销。提出了一种自适应和选择性的检测方式。该技术从基线采样间隔开始, 并在运行中不断调整间隔以适应不断变化的应用行为。
    管理员可以用主动或被动的方式收集测量数据。
    许多主动监控工作估计链路的延迟, 丢包率, 容量, 吞吐量或精确的瓶颈位置。UAMA [23]是一种主动探测器管理架构，用于收集和管理来自许多不同类型的有源探测器的信息。 执行被动监视的工作包括与采样数据包和收集特定于设备的统计信息（如CPU和内存利用率）相关的工作。 有些工作使用主动和被动监控。 在[24]中，每个网络节点根据其流量负载插入唯一的数据包标记，然后边缘节点通过观察这些标记来估计网络的流量负载
    一些工作建议在现有路由器中增加功能，以便使主动监控更容易，更准确。 [25,26]建议收集设备在探测包中插入更多信息。 例如，更精细的分辨率时间戳将允许对排队行为进行细粒度测量，并简化诸如链路容量和可用带宽之类的属性的推断。 [27,28]建议路由器转发具有可调优先级的测量数据包。 路由器对ICMP数据包的处理方式不同，而网络运营商可能希望ICMP数据包与某些特定测量数据包的处理方式相同。 对于其他测量，运营商可能希望测量分组具有最高优先级，以使这些分组不经历任何排队延迟。
    采样是减少监控节点开销和执行有效监控的一种方法。 由于丢失了非抽样信息，因此大多数关于抽样的工作都集中在提高测量精度上。 一些工作通过动态调整采样率来平衡监控精度和效率。 例如，[29,30]在低开销条件下提高采样率; 当交通量低或只有少量流量时。 [31]首先使用包头中的序列号来推断未采样的包的数量，然后推断出不同包流的相对大小。 RRDTool [32]通过内插缺失值来解决样本丢失和延迟，使它们以恒定的时间间隔出现
    一些以前的工作建议在整个网络中使用一致的散列函数进行抽样。 仅当其散列值落在特定散列范围内时才对数据包进行采样。 该范围由运营商设定。 通过这种方式，他们可以根据不同的监控目标精确控制要采样的数据包集。 轨迹采样[33,34]建议在整个网络中使用相同的哈希范围。 以这种方式，操作员可以重建采样分组的完整轨迹而无需路由信息。 完整的轨迹既可用于估计不同链路上的流量需求，也可用于定位转发问题，例如转发环路。 cSamp [35]在不同的收集设备上分配不同的散列范围，以满足两个目标：最小化收集设备的冗余采样，同时能够观察和采样所有网络流

这些总结需要添加文献内容:
    - 数据的特征
    - 数据收集的方式?
        - SNMP
        - 主动轮询
    - 数据收集的类型?
        - 网络延迟
        - 丢包率
        - 组件性能指标
            - 内存利用率
            - CPU利用率

+ 网络检测技术的关键 —— 数据处理
   根据现有文献, 对过往检测系统采用的检测策略进行了总结:

    1) 基于模型的检测(Model-Based Detection)。基于模型的推理中, 检测分析建立在面向对象的模型基础之上, 目标系统的实体都将模型化为诊断对象, 这些诊断对象之间的关联关系被清晰地描述, 从模型上也反映了实际系统的结构行为。基于模型的故障检测问题来源于模型和实际系统的差异, 模型是对现实系统物理结构及其构成的理想描述, 构成模型的基本成分要满足一定的规则。在检测的过程中, 首先假设物理系统的所有组成部分都遵循模型的约定, 通过度量和观察结构发现实际系统和理想模型之间的差异, 最后假设其中的某些组成部分没有满足模型的约定, 从而达到能够解释实际系统和理想模型之间偏差的目的。

    2) 基于案例的检测(Cased-Based Detection)。基于案例的检测是通过过去求解类似问题的经验和知识获得当前问题结果的一种检测模式。基于案例的检测系统通常由案例索引机制、检索机制、案例改写和案例库四个核心功能部件构成。其中, 案例库提供支持问题求解的一组案例, 它是系统过去进行问题求解经验的聚集。根据问题描述, 案例检索机制从案例库中查找一个与当前问题相匹配的案例, 如果该案例满足问题描述的要求, 则输出相应的结果, 否则根据问题描述, 对检索出的案例进行修改, 案例改写的结果形成一个满足全部问题描述要求的答案, 该结果同时作为一个新的案例经索引机制组织到案例库中以备将来使用。

    3) 基于编码的检测(Code-Based Detection)。每个故障的产生都会引起大量症状事件的发生, 每个对象产生的故障症状事件可能是该对象自身故障问题引发的本地事件, 也可能是有关联关系的对象出现故障, 传播过来引发的事件。处理这些由故障而引发症状事件的方法是把事件看成一个标识故障的"密码", 相关性分析的过程就是对症状事件进行解码的过程, 最终确定密码标识的、出现症状事件的故障列表。

    4) 依赖关系图模型(Dependency Graph Model)。在网络检测系统中, 故障往往不是显而易见的。系统常常监测到一些故障表现(异常), 但很难根据这些异常来直接定位故障源, 这些都是由于网络中被管对象之间的相互依赖关系导致故障传播的结果。依赖关系图可以表示为有向图G=(O,D), 其中O是有限非空的对象集合, D是对象之间边的集合, 若有直连边(oi, oj)属于D, 表示对象oi上发生的错误或故障将导致对象oj上故障的发生, 每个有向边标注的条件概率表示有向边的头节点和尾节点之间的依赖程度。依赖关系图为故障检测提供了一般性的自然描述, 对网络系统的模拟简明了很多。

+ 问题与挑战
    计算机网络检测系统是计算机网络管理系统的核心模块之一, 至今已有20余年的研究历史。本文首先归纳了造成互联网用户体验下降的常见问题原因, 然后概括性地描述了网络检测技术中数据采集的类型、方式和挑战, 最后对过往网络检测系统采用的检测策略进行了总结。本课题将致力于开发一个在问题发生时可以指导管理人员以最小代价、最快速度明确问题、定位原因和解决问题的网络检测工具。

+ 参考文献

----

中文文献
+ 陈琳. (2005). 网络故障诊断关键技术的研究. J]. 国防科学技术大学.
+ 郑秋华. (2007). 网络故障智能诊断关键技术研究 (Doctoral dissertation).

----
外语文献

+ 2005
    - Dynamic Syslog Mining for Network Failure Monitoring
    - Improving Accuracy in End-to-end Packet Loss Measurement

+ 2009
    - Detailed Diagnosis in Enterprise Networks

+ 2011
    - Understanding Network Failures in Data Centers: Measurement, Analysis, and Implications
    - Instrumenting Home Networks

+ 2012
    - NetPilot: Automating Datacenter Network Failure Mitigation

+ 2013
    - Improving Network Management with Software Defined Networking
    - Gestalt: Unifying fault localization for networked systems

+ 2014
    - Network monitoring: Present and future

+ 2015
    - Performance Anomaly Detection and Bottleneck Identification
    - A Survey on Internet Performance Measurement Platforms and Related Standardization Efforts
    - Pingmesh: A Large-Scale System for Data Center Network Latency Measurement and Analysis

+ 2016
    - Pythia: Detection, Localization, and Diagnosis of Performance Problems
    - The Good, the Bad, and the Differences: Better Network Diagnostics with Differential Provenance

+ 2018
    - 007: Democratically Finding The Cause of Packet Drops
    - Proactive Failure Detection Learning Generation Patterns of Large-scale Network Logs

+ 2019
    - Network Telemetry: Towards A Top-Down Approach
    - Fusing information from tickets and alerts to improve the incident resolutio process

# 四、方案论证

+ 群智能方法在无线传感器网络节点定位中的应用
    引言
    1. 本课题将采用的PSD算法的变体
        A. 带有惯性权重的粒子群算法
        B. 带有收缩因子的粒子群算法
        C. 动态概率粒子群优化模型
    2. 本课题将采用的WSN节点定位的优化方案
        A. 基于测距定位方法的粒子群优化
        B. 基于约束粒子群的节点定位优化方法
        C. 基于DV-Hop算法的粒子群优化
    3. 评测指标

+ 基于参照点的反 Top-k 查询 Why-not 问题研究
    1. 问题描述
    2. 方案设计
    3. 可行性分析

## 五、时间规划
